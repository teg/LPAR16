\chapter{Definitions}

%---------------------------------------
\begin{definition}
We call the following six diagrams (\emph{atomic-flow}) \emph{labels}:
\[
\begin{array}{@{}c@{}c@{}c@{}}
      \vcenter{\afaid{}{}{}{}{}{}}&
\qquad\vcenter{\afawd{}{}{}{}}&
\qquad\vcenter{\afacd{}{}{}{}{}{}}\\
\noalign{\smallskip}
      \mbox{$\aid$ or \emph{interaction}}&
\qquad\mbox{$\awd$ or \emph{weakening}}&
\qquad\mbox{$\acd$ or \emph{contraction}}\\
\noalign{\bigskip}
      \vcenter{\afaiu{}{}{}{}{}{}}&
\qquad\vcenter{\afawu{}{}{}{}}&
\qquad\vcenter{\afacu{}{}{}{}{}{}}\\
\noalign{\smallskip}
      \mbox{$\aiu$ or \emph{cut}}&
\qquad\mbox{$\awu$ or \emph{coweakening}}&
\qquad\mbox{$\acu$ or \emph{cocontraction}}\\
\end{array}\quad.
\]
\end{definition}

\TODO{Make sure the symbols we use later are all defined here. In particular we need $\iota$ to denote edges, maybe also more.}

\newcommand{\ppl  }{{\mathchoice{\scriptstyle+}
                                {\scriptstyle+}
                                {\scriptstyle+}
                                {\scriptscriptstyle+}}}
\newcommand{\pmi  }{{\mathchoice{\scriptstyle-}
                                {\scriptstyle-}
                                {\scriptstyle-}
                                {\scriptscriptstyle-}}}
\newcommand{\card}[1]{\mathord\vert #1\mathord\vert}
\newcommand{\up}{{\mathit up}}
\newcommand{\lo}{{\mathit lo}}
%---------------------------------------
\begin{definition}
An (\emph{atomic}) \emph{flow} is a tuple $(V,E,\eta,\up,\lo)$, denoted $\phi$ or $\psi$, such that:
\begin{enumerate}
%-------------------
\item $V$ is a finite set of \emph{vertices}, denoted by $\nu$;
%-------------------
\item $E$ is a finite set of \emph{edges}, denoted by $\epsilon$;
%-------------------
\item $\eta\colon V\to\{\aid,\aiu,\awd,\awu,\acd,\acu\}$ maps vertices to their \emph{labels};
%-------------------
\item $\up\colon E\to V\cup\{\top\}$ and $\lo\colon E\to V\cup\{\bot\}$ are, respectively, the \emph{upper} and \emph{lower} maps, and $\top$ and $\bot$ are special vertices not belonging to $V$; we define, for every $\nu\in V\cup\{\top,\bot\}$, the set $L_\nu=\{\,\epsilon\mid\up(\epsilon)=\nu\,\}$ of \emph{lower edges of $\nu$}, the set $U_\nu=\{\,\epsilon\mid\lo(\epsilon)=\nu\,\}$ of \emph{upper edges of $\nu$}, and the set $E_\nu=L_\nu\cup U_\nu$ of \emph{edges of $\nu$};
%-------------------
\item if $\card S$ denotes the cardinality of set $S$, we have that
\begin{align*}
\mbox{if $\eta(\nu)=\aid$ then $\card{L_\nu}=2$ and $\card{U_\nu}=0$,}&\\
\mbox{if $\eta(\nu)=\aiu$ then $\card{L_\nu}=0$ and $\card{U_\nu}=2$,}&\\
\mbox{if $\eta(\nu)=\awd$ then $\card{L_\nu}=1$ and $\card{U_\nu}=0$,}&\\
\mbox{if $\eta(\nu)=\awu$ then $\card{L_\nu}=0$ and $\card{U_\nu}=1$,}&\\
\mbox{if $\eta(\nu)=\acd$ then $\card{L_\nu}=1$ and $\card{U_\nu}=2$,}&\\
\mbox{if $\eta(\nu)=\acu$ then $\card{L_\nu}=2$ and $\card{U_\nu}=1$;}&
\end{align*}
%-------------------
\item\label{ItAcycl} there is no sequence $\epsilon_1,\dots,\epsilon_h$ of edges of $V$ such that $\up(\epsilon_i)=\lo(\epsilon_{i+1\pmod h})$, for $1\le i\le h$;
%-------------------
\item\label{ItPol} there is a \emph{polarity assignment} $\pi\colon E\to\{\pmi,\ppl\}$ such that, for every $\nu\in V$,
\begin{enumerate}
%---------
\item if $\eta(\nu)\in\{\acd,\acu\}$ then $\pi(E_\nu)=\{\pmi\}$ or $\pi(E_\nu)=\{\ppl\}$;
%---------
\item if $\eta(\nu)\in\{\aid,\aiu\}$ then $\pi(E_\nu)=\{\pmi,\ppl\}$.
\end{enumerate}
\end{enumerate}
Given an atomic flow $\phi$, we say that the sets $L_\top=\{\epsilon_1,\dots,\epsilon_h\}$ and $U_\bot=\{\epsilon'_1,\dots,\epsilon'_k\}$ contain, respectively, the \emph{upper} and \emph{lower edges of $\phi$}.
\end{definition}

\TODO{Explain the use of colors and small numerals.}

\newcommand{\one  }{{\mathchoice{\scriptstyle\mathbf1}
                                {\scriptstyle\mathbf1}
                                {\scriptstyle\mathbf1}
                                {\scriptscriptstyle\mathbf1}}}
\newcommand{\two  }{{\mathchoice{\scriptstyle\mathbf2}
                                {\scriptstyle\mathbf2}
                                {\scriptstyle\mathbf2}
                                {\scriptscriptstyle\mathbf2}}}
\newcommand{\three}{{\mathchoice{\scriptstyle\mathbf3}
                                {\scriptstyle\mathbf3}
                                {\scriptstyle\mathbf3}
                                {\scriptscriptstyle\mathbf3}}}
\newcommand{\four }{{\mathchoice{\scriptstyle\mathbf4}
                                {\scriptstyle\mathbf4}
                                {\scriptstyle\mathbf4}
                                {\scriptscriptstyle\mathbf4}}}
\newcommand{\five }{{\mathchoice{\scriptstyle\mathbf5}
                                {\scriptstyle\mathbf5}
                                {\scriptstyle\mathbf5}
                                {\scriptscriptstyle\mathbf5}}}
\newcommand{\six  }{{\mathchoice{\scriptstyle\mathbf6}
                                {\scriptstyle\mathbf6}
                                {\scriptstyle\mathbf6}
                                {\scriptscriptstyle\mathbf6}}}
\newcommand{\seven}{{\mathchoice{\scriptstyle\mathbf7}
                                {\scriptstyle\mathbf7}
                                {\scriptstyle\mathbf7}
                                {\scriptscriptstyle\mathbf7}}}
\newcommand{\eight}{{\mathchoice{\scriptstyle\mathbf8}
                                {\scriptstyle\mathbf8}
                                {\scriptstyle\mathbf8}
                                {\scriptscriptstyle\mathbf8}}}
\newcommand{\nine }{{\mathchoice{\scriptstyle\mathbf9}
                                {\scriptstyle\mathbf9}
                                {\scriptstyle\mathbf9}
                                {\scriptscriptstyle\mathbf9}}}

\TODO{Make sure we define atomic flows modulo associativity of contraction and graph isomorphism.}

\TODO{Define `\emph{super paths}'.}

\TODO{Define connected component.}

\TODO{Define subflow}.

\TODO{Clean out old stuff from the following sub section.}

\newpage

\begin{definition}
Given two atomic flows $\phi$ and $\psi$, we say that \emph{$\phi$ is a copy of $\psi$} if $\phi$ and $\psi$ are isomorphic and we have chosen a bijection between their edges. If $\phi$ is a copy of $\psi$ and $f$ is the bijection between their edges, we give $\phi$ and $\psi$ the same label and if $\epsilon$ is an edge of $\phi$ then we label $f(\epsilon)$ by $\hat\epsilon$, $\tilde\epsilon$ or $\epsilon^1$, $\epsilon^2$, $\dots$.
\end{definition}

\begin{definition}
Given two atomic flows $\phi$ and $\psi$, we say that the upper (resp., lower) edge $\epsilon$ of $\psi$ \emph{corresponds to} the upper (resp., lower) edge $\epsilon'$ of $\phi$ if $\psi$ contains $n\ge1$ copies of $\phi$, and $f_1$, $\dots$, $f_n$ (resp., $g_1$, $\dots$, $g_n$) are the bijections, restricted to the upper (resp., lower) edges, between $\phi$ and each of its copies, and for every $1\le i\le n$, there is a path from $\epsilon'$ to $f_i(\epsilon)$ (resp., $g_i(\epsilon)$) and, for every other upper (resp., lower) edge $\epsilon''$ of $\psi$, there is no path form $\epsilon'$ to $f_i(\epsilon'')$ (resp., $g_i(\epsilon'')$). If $\epsilon$ corresponds to $\epsilon'$ we sometimes refer to them by the same name.
%If $\epsilon_1$, $\dots$, $\epsilon_n$ correspond to $\epsilon'_1$, $\dots$, $\epsilon'_n$, respectively, we write $\langle\epsilon_1,\dots,\epsilon_n\rangle\leftrightarrow\langle\epsilon'_1,\dots,\epsilon'_n\rangle$.
\end{definition}

\begin{remark}
If $\epsilon$ in $\phi$ corresponds to $\epsilon'$ in $\psi$ it is not a problem to refer to them by the same name since they belong to different atomic flows and since $\epsilon$ can at most correspond to one edge in $\psi$.
\end{remark}

\begin{example}
Consider the following atomic flow:
\[
\atomicflow
{
(0,0)="A";
"A"+(-2, 6)*{\afvju4{\epsilon_1}{}};
"A"+( 0, 6)*{\cdots};
"A"+( 2, 6)*{\afvju4{}{\epsilon_n}};
"A"+( 0, 0)*{\affr88};
"A"+( 1, 2)*{\aflabelright{\phi}};
"A"+(-2,-6)*{\afvjd4{\iota_1}{}};
"A"+( 0,-6)*{\cdots};
"A"+( 2,-6)*{\afvjd4{}{\iota_m}};
}\quad.
\]
We now build a flow containing two copies of $\phi$ where we indicate both the correspondence between upper (reps., lower) edges of $\phi$ and the new flow, and the bijections between the upper (resp., lower) edges of $\phi$ and each of its copies:
\[
\atomicflow
{
(-2,12)*{\afacuex{}{}{}{}{\epsilon_1}{}52};
( 0,14)*{\cdots};
( 2,12)*{\afacuex{}{}{}{}{}{\epsilon_n}52};
%
(-5,0)="A";
"A"+(-2, 6)*{\afvju4{\hat\epsilon_1}{}};
"A"+( 0, 6)*{\cdots};
"A"+( 2, 6)*{\afvju4{}{\hat\epsilon_n}};
"A"+( 0, 0)*{\affr88};
"A"+( 1, 2)*{\aflabelright{\phi}};
"A"+(-2,-6)*{\afvjd4{\hat\iota_1}{}};
"A"+( 0,-6)*{\cdots};
"A"+( 2,-6)*{\afvjd4{}{\hat\iota_m}};
%
(5,0)="A";
"A"+(-2, 6)*{\afvju4{\tilde\epsilon_1}{}};
"A"+( 0, 6)*{\cdots};
"A"+( 2, 6)*{\afvju4{}{\tilde\epsilon_n}};
"A"+( 0, 0)*{\affr88};
"A"+( 1, 2)*{\aflabelright{\phi}};
"A"+(-2,-6)*{\afvjd4{\tilde\iota_1}{}};
"A"+( 0,-6)*{\cdots};
"A"+( 2,-6)*{\afvjd4{}{\tilde\iota_m}};
%
(-2,-12)*{\afacdex{}{}{}{}{\iota_1}{}52};
( 0,-14)*{\cdots};
( 2,-12)*{\afacdex{}{}{}{}{}{\iota_n}52};
}\quad.
\]
Note that the above atomic flow contains redundant information and the following atomic flow is indeed unique modulo isomorphism:
\[
\atomicflow
{
(-2,12)*{\afacuex{}{}{}{}{\epsilon_1}{}52};
( 0,14)*{\cdots};
( 2,12)*{\afacuex{}{}{}{}{}{\epsilon_n}52};
%
(-5,0)="A";
"A"+(-2, 6)*{\afvju4{}{}};
"A"+( 0, 6)*{\cdots};
"A"+( 2, 6)*{\afvju4{}{}};
"A"+( 0, 0)*{\affr88};
"A"+( 1, 2)*{\aflabelright{\phi}};
"A"+(-2,-6)*{\afvjd4{}{}};
"A"+( 0,-6)*{\cdots};
"A"+( 2,-6)*{\afvjd4{}{}};
%
(5,0)="A";
"A"+(-2, 6)*{\afvju4{}{}};
"A"+( 0, 6)*{\cdots};
"A"+( 2, 6)*{\afvju4{}{}};
"A"+( 0, 0)*{\affr88};
"A"+( 1, 2)*{\aflabelright{\phi}};
"A"+(-2,-6)*{\afvjd4{}{}};
"A"+( 0,-6)*{\cdots};
"A"+( 2,-6)*{\afvjd4{}{}};
%
(-2,-12)*{\afacdex{}{}{}{}{\iota_1}{}52};
( 0,-14)*{\cdots};
( 2,-12)*{\afacdex{}{}{}{}{}{\iota_n}52};
}\quad.
\]
\end{example}

\newpage

%=======================================
\subsection{Paths and Cycles}

We now define the notions of `$\ai$-path' and `$\ai$-cycle' in atomic flows. Paths are sequences of adjacent edges that only `go down' or only `go up'; $\ai$-paths are formed by joining paths at interaction or cointeraction vertices; $\ai$-cycles are circular $\ai$-paths. We also define the notion of `simple edge', \emph{i.e.}, an edge connecting an interaction and a cointeraction, as in the first diagram in this paper.

%---------------------------------------
\begin{definition}
Given an atomic flow $(V,E,\eta,\up,\lo)$ and $\epsilon_1,\dots,\epsilon_h\in E$ such that, for $1\le i<h$, we have $\lo(\epsilon_i)=\up(\epsilon_{i+1})$, $\up(\epsilon_1)=\nu$ and $\lo(\epsilon_h)=\nu'$, we say that $\epsilon_1,\dots,\epsilon_h$ is a \emph{path from $\nu$ to $\nu'$} and that $\epsilon_h,\dots,\epsilon_1$ is a \emph{path from $\nu'$ to $\nu$}; both paths have \emph{length} $h$. An \emph{$\ai$-path from $\nu$ to $\nu'$} of \emph{length} $h$ is either a path from $\nu$ to $\nu'$ of length $h$ or a sequence of edges $\epsilon_1,\dots,\epsilon_k,\epsilon_{k+1},\dots,\epsilon_h$ such that $\epsilon_k \ne \epsilon_{k+1}$ and, for some $\nu''\in V$ with $\eta(\nu'')\in\{\aid,\aiu\}$, we have that $\epsilon_1,\dots,\epsilon_k$ is an $\ai$-path from $\nu$ to $\nu''$ and $\epsilon_{k+1},\dots,\epsilon_h$ is an $\ai$-path from $\nu''$ to $\nu'$. An $\ai$-path of length $h$ is \emph{maximal} if no $\ai$-path containing its edges has length greater than $h$. An $\ai$-path from (resp., to) $\nu$ of length $h$ is a \emph{maximal\/ $\ai$-path from} (resp., \emph{to}) $\nu$ if no $\ai$-path from (resp., to) $\nu$ containing its edges has length greater than $h$. A path from an interaction to a cointeraction vertex or vice versa is called an \emph{$\ai$-connection}.
\end{definition}

%---------------------------------------
\begin{example}
The atomic flow on the left has the $\ai$-paths on the right, and the paths are marked with an asterisk:
\[
\begin{array}{@{}c@{}c@{}}
\atomicflow{
( 2  ,10)*{\afaidnw{}{}};
( 0  , 6)*{\afvju8\one{}};
( 6  , 6)*{\afacd\two{}\three{}\four{}};
( 8  , 8)*{\afawunw{}{}};
(10  , 6)*{\afvjd8{}\five};
( 8  , 0)*{\afaiunw{}{}};
(-1.5, 0)*{\invisiblemark};
(11.5, 0)*{\invisiblemark}}
\qquad&
\begin{array}{@{}lllll@{}}
\one^*               &                &                  &           &       \\
\one,\two            &\two^*          &\three^*          &           &       \\
\one,\two,\four      &\two,\four^*    &\three,\four^*    &\four^*    &       \\
\one,\two,\four,\five&\two,\four,\five&\three,\four,\five&\four,\five&\five^*\\
\end{array}\quad.
\\
\end{array}
\]
In addition, the flow has the paths and $\ai$-paths obtained from the shown ones by inverting the order of edges, for example $\five,\four,\two,\one$ is an $\ai$-path. The $\ai$-paths from the interaction vertex are $\one$ and $\two$ and $\two,\four$ and $\two,\four,\five$; the $\ai$-paths to the contraction vertex are $\one,\two$ and $\two$ and $\three$ and $\four$ and $\five,\four$; of all the $\ai$-paths to the cointeraction vertex, $\two,\four$ is the only $\ai$-connection; the only other $\ai$-connection in the flow is $\four,\two$. The maximal $\ai$-paths are $\one,\two,\four,\five$ and $\three,\four,\five$ and their inverses. The maximal $\ai$-paths from the cointeraction vertex are $\four,\two,\one$ and $\four,\three$ and $\five$; the maximal $\ai$-paths to the contraction vertex are $\one,\two$ and $\three$ and $\five,\four$.
\end{example}

Simple edges represent immediate causality relations between axioms and cuts. They play a crucial role in the following, in particular when they belong to $\ai$-cycles.

%---------------------------------------
\begin{definition}\label{DefSimple}
An $\ai$-connection consisting of a single edge is called a \emph{simple edge}. A \emph{clean path} is an $\ai$-path where every $\ai$-connection is a simple edge. An \emph{$\ai$-cycle} is an $\ai$-path from a vertex to itself, where no edge appears twice; we do not distinguish $\ai$-cycles that only differ for cyclic permutations of their edges or for inversion, so, if $\epsilon_1,\dots,\epsilon_h$ is an $\ai$-cycle, then $\epsilon_2,\dots,\epsilon_h,\epsilon_1$ and $\epsilon_h,\dots,\epsilon_1$ are the same $\ai$-cycle. A \emph{fragile cycle} is an $\ai$-cycle containing a simple edge. Atomic flows and $\ai$-paths are both called \emph{cycle-free} if they do not contain $\ai$-cycles.
\end{definition}

%---------------------------------------
\begin{example}\label{ExExtrem}
In the following cycle-free flow all the $\ai$-paths are clean paths; $\one$, $\two$ and $\three$ are $\ai$-connections and simple edges:
\[
\atomicflow{
( 2,0)*{\afaiu{}{}\one{}{}{}};
( 0,4)*{\afacdnw{}{}{}{}};
( 6,4)*{\afaidnw{}{}};
(10,0)*{\afaiu\two{}\three{}{}{}};
(14,4)*{\afaidnw{}{}{}{}};
(18,0)*{\afacd{}{}{}{}{}{}}}
\quad.
\]
\end{example}

%---------------------------------------
\begin{example}
Consider the following atomic flow:
\nopagebreak[4]\medskip\afnegspace
\[
\atomicflow{
( 8,12)*{\afaidex\one{}{}\two{}{}41};
( 0, 6)*{\afacunw\three{}{}\four};
(16, 6)*{\afacunw\seven{}{}\eight};
( 8, 8)*{\afaid{}\five\six{}{}{}};
( 4, 2)*{\afaiunw{}{}};
(12, 2)*{\afaiunw{}{}};
( 8, 0)*{\afaiuex{}{}{}{}{}{}51}}
\quad.
\]
\afnegspace
The flow contains two $\ai$-cycles: $\one,\four,\five,\six,\seven,\two$ and $\one,\three,\eight,\two$. The first $\ai$-cycle contains the two simple edges $\five$ and $\six$, so it is a fragile cycle; the second $\ai$-cycle does not contain any simple edge. Note that the two $\ai$-cycles are `overlapping', in the sense that edges $\one$ and $\two$ belong to both.
\end{example}
