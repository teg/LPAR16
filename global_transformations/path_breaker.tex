\TODO{Import from AFII when the paper is final.}



\newcommand{\frpb}{{\mathsf{pb}}}
%---------------------------------------
\begin{definition}\label{definition:PathBreaker}
We define the reduction $\to_\frpb$ (where $\frpb$ stands for \emph{path breaker}) as follows, for any two atomic flows $\phi$, with upper edges $\boldsymbol\epsilon$ and lower edges $\boldsymbol\iota$, and $\psi$ with upper edges $\boldsymbol{\epsilon'}$ and lower edges $\boldsymbol{\iota'}$:
\[
\atomicflow
{
(-8, 7)*{\afvjdm{6}{\boldsymbol\epsilon}{}};
( 0, 8)*{\afaid{}{}{}{}{}{}};
( 8, 7)*{\afvjdm{6}{}{\boldsymbol{\epsilon'}}};
(-5, 0)*{\affr{8}{8}};
(-4, 2)*{\aflabelright\phi};
%---
( 5, 0)*{\affr{8}{8}};
( 6, 2)*{\aflabelright{\psi}};
( 8,-7)*{\afvjum{6}{}{\boldsymbol{\iota'}}};
( 0,-8)*{\afaiu{}{}{}{}{}{}};
(-8,-7)*{\afvjum{6}{\boldsymbol\iota}{}};
}
\quad\to_\frpb\quad
\atomicflow
{
%%%%% RED %%%%%
(0,-20)="D";
(0,-10)="Dhalf";
%% contractions
"D"+"D"="A";
%left
"A"+(-14,-15.5)-"D"*{\afvjmcol{23}{Red}};
"A"+(-11,-17)*{\afvjumcol{4}{\boldsymbol\iota}{}{Red}};
%right
"A"+(11,-11.5)-"Dhalf"*{\afvjmcol{11}{Red}};
"A"+(14,-15.5)-"D"*{\afvjmcol{23}{Red}};
"A"+(11,-17)*{\afvjumcol{4}{}{\boldsymbol{\iota'}}{Red}};
% top boxes
(0,0)="A";
"A"+(-11,-14)*{\afcjrmcol{6}{20}{Red}};
"A"+(11,-14)*{\afcjlmcol{6}{20}{Red}};
"A"+( 0,  8)*{\afaidcol{}{}{}{}{}{}{Red}{Red}};
"A"+(-2, -8)*{\afawucol{}{}{}{}{}{Red}};
% join one
"A"+(2,-10)*{\afvjcol{12}{Red}};
% middle boxes
"A"+"D"="A";
"A"+(9.5,-10)*{\afcjlmcol{3}{12}{Red}};
"A"+( 2,-8)*{\afawucol{}{}{}{}{}{Red}};
%%%%% GREEN %%%%%
%% cocontractions
(0,0)="A";
%left
"A"+(-11,17)*{\afvjdmcol{4}{\boldsymbol\epsilon}{}{OliveGreen}};
"A"+"D"+(-14,15.5)*{\afvjmcol{23}{OliveGreen}};
"A"+"Dhalf"+(-11,11.5)*{\afvjmcol{11}{OliveGreen}};
%right
"A"+(11,17)*{\afvjdmcol{4}{}{\boldsymbol{\epsilon'}}{OliveGreen}};
"A"+"D"+(14,15.5)*{\afvjmcol{23}{OliveGreen}};
% middle boxes
"A"+"D"="A";
"A"+(-9.5,10)*{\afcjlmcol{3}{12}{OliveGreen}};
"A"+(-2, 8)*{\afawdcol{}{}{}{}{}{OliveGreen}};
% join two
"A"+(-2,-10)*{\afvjcol{12}{OliveGreen}};
% bottom boxes
"A"+"D"="A";
"A"+(-11,14)*{\afcjlmcol{6}{20}{OliveGreen}};
"A"+(11,14)*{\afcjrmcol{6}{20}{OliveGreen}};
"A"+( 0,-8)*{\afaiucol{}{}{}{}{}{}{OliveGreen}{OliveGreen}};
"A"+( 2, 8)*{\afawdcol{}{}{}{}{}{OliveGreen}};
%%%%% BLACK %%%%%
%% cocontractions
(0,0)="A";
%left
"A"+(-8,5.5)*{\afvjm3};
"A"+(-11,11)*{\affr88};
"A"+(-11,11)*{\copy\contrup};
%right
"A"+(8,5.5)*{\afvjm3};
"A"+"Dhalf"+(11,11.5)*{\afvjm{11}};
"A"+(11,11)*{\affr88};
"A"+(11,11)*{\copy\contrup};
%% contractions
"D"+"D"="A";
%left
"A"+(-11,-11.5)-"Dhalf"*{\afvjm{11}};
"A"+(-8,-5.5)*{\afvjm3};
"A"+(-11,-11)*{\affr88};
"A"+(-11,-11)*{\copy\contrdown};
%right
"A"+(8,-5.5)*{\afvjm3};
"A"+(11,-11)*{\affr88};
"A"+(11,-11)*{\copy\contrdown};
% top boxes
(0,0)="A";
"A"+(-5,  0)*{\affr{8}{8}};
"A"+(-4,  2)*{\aflabelright{\phi}};
"A"+( 5,  0)*{\affr{8}{8}};
"A"+( 6,  2)*{\aflabelright{\psi}};
% middle boxes
"A"+"D"="A";
"A"+(9.5,10)*{\afcjrm{3}{12}};
"A"+(-9.5,-10)*{\afcjrm{3}{12}};
"A"+(-5, 0)*{\affr{8}{8}};
"A"+(-4, 2)*{\aflabelright{\phi}};
"A"+( 5, 0)*{\affr{8}{8}};
"A"+( 6, 2)*{\aflabelright{\psi}};
% bottom boxes
"A"+"D"="A";
"A"+(-5, 0)*{\affr{8}{8}};
"A"+(-4, 2)*{\aflabelright{\phi}};
"A"+( 5, 0)*{\affr{8}{8}};
"A"+( 6, 2)*{\aflabelright{\psi}};
}\quad,
\]
where the evidenced interaction and cut vertices belong to the same connected component.
\end{definition}

\begin{theorem}\label{theorem:PathBreakerSound}
Reduction $\to_\frpb$ is sound.
\end{theorem}

\TODO{Define `evidenced'.}

\begin{proof}
Let $\Phi$ be a derivation with flow $\phi'$, such that $\phi'\to_\frpb\psi'$. We show that there exists a derivation $\Psi$ with flow $\psi'$ and with the same premiss and conclusion as $\Phi$. In the following, we refer to the figure in Definition~\vref{definition:PathBreaker}.

Since the evidenced interaction and cut vertices belong to the same connected component, we can assume that the $\ai$-decomposed form of $\Phi$ is
\[
\vlder{\Phi'}{}
{
 \vls[\beta\;.\;\vlinf{}{}{\fff}{\vls(a^\phi.\bar a^\psi)}]
}
{
 \vls(\vlinf{}{}{\vls[a^\phi.\bar a^\psi]}{\ttt}\;.\;\alpha)
}\quad.
\]
We combine three copies of $\Phi'$ to obtain the desired derivation $\Psi$ with flow $\psi'$ and the same premiss and conclusion as $\Phi$:
\newbox\DeltaTopK
\setbox\DeltaTopK=
\hbox{$
\vlder{\Phi'}{}
{
 \vls[\beta\;.\;(\vlinf{}{}{\ttt}{a^\phi}\;.\;\bar a^\psi)]
}
{
 \vls(\vlinf{}{}{\vls[a^\phi.\bar a^\psi]}{\ttt}\;.\;\alpha)
}
$}
\newbox\DeltaK
\setbox\DeltaK=
\hbox{$
\vlder{\Phi'}{}
{
 \vls[\beta\;.\;(a^\phi.\vlinf{}{}{\ttt}{\bar a^\psi})]
}
{
 \vls([\vlinf{}{}{a^\phi}{\fff}\;.\;\bar a^\psi]\;.\;\alpha)
}
$}
\newbox\DeltaBotK
\setbox\DeltaBotK=
\hbox{$
\vlder{\Phi'}{}
{
 \vls[\beta.\vlinf{}{}{\fff}{\vls(a^\phi.\bar a^\psi)}]
}
{
 \vls([a^\phi\;.\;\vlinf{}{}{\bar a^\psi}{\fff}]\;.\;\alpha)
}
$}
\[
\Psi\quad=\quad
\vlderivation
{
 \vlin{2\cdot\cod}{}{\beta}
 {
  \vlin{=}{}{\vlsbr[\beta\;\;\;\;.\;\;\;\;\beta\;\;\;\;.\;\;\;\;\box\DeltaBotK]}
  {
   \vlin{\swi}{}{\vlsmallbrackets\vls[(\alpha.a^\phi).[\beta.\beta]]}
   {
    \vlin{=}{}{\vlsmallbrackets\vls(\alpha.[a^\phi.[\beta.\beta]])}
    {
     \vlin{=}{}{\vlsbr([\beta\;\;\;\;.\;\;\;\;\box\DeltaK]\;\;\;\;.\;\;\;\;\alpha)}
     {
      \vlin{=}{}{\vls(\vlinf{\swi}{}{\vlsmallbrackets\vls[(\alpha.\bar a^\psi).\beta]}{\vlsmallbrackets\vls(\alpha.[\bar a^\psi.\beta])}\;.\;\alpha)}
      {
       \vlin{2\cdot\cou}{}{\vlsbr(\box\DeltaTopK\;\;\;\;.\;\;\;\;\alpha\;\;\;\;.\;\;\;\;\alpha)}
       {
        \vlhy{\alpha}
       }
      }
     }
    }
   }
  }
 } 
}\quad.
\]
\end{proof}

\TODO{Find a way to define `evidenced' so this makes sense...}

\begin{proposition}\label{proposition:PathBreak}
Given atomic flows $\phi$ and $\psi$, such that $\phi\to_\frpb\psi$, then
\begin{itemize}
 \item there is no path from the evidenced interaction vertex to the evidenced cut vertex in $\psi$, and
 \item there is a path from the upper edge $\epsilon$ to the lower edge $\iota$ of $\psi$ if and only if there is a path from the upper edge $\epsilon$ to the lower edge $\iota$ of $\phi$.
\end{itemize}
\end{proposition}

\TODO{Redo proof.}

\begin{proof}
Refer to the atomics in Definition~\vref{definition:PathBreaker}.
\begin{itemize}
	\item All the edges that might be in paths from $\epsilon$ or $\epsilon'$ are coloured in red and all the edges that might be in paths to $\iota$ or $\iota'$ are coloured in green. Since the red and the green paths do not overlap, there are no paths from $\epsilon$ to $\iota$ and no paths from $\epsilon'$ to $\iota'$; and
	\item If there is a path from an upper edge $\epsilon''$ to a lower edge $\mu''$ in the atomic flow of $\Psi$ the path must pass through one of the three copies of either $\phi$ or $\psi$, hence there must be a path from the corresponding upper edge $\lambda''$ to the corresponding lower edge $\mu''$ in the atomic flow of $\Phi$.
\end{itemize}
\end{proof}
