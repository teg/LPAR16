\TODO{Add labels to edges}

\newcommand{\frpb}{{\mathsf{pb}}}
%---------------------------------------
\begin{definition}\label{definition:PathBreaker}
We define the reduction $\to_\frpb$ (where $\frpb$ stands for \emph{path breaker}) as follows, for any atomic flows $\phi$ and $\psi$:
\[
\atomicflow
{
(-8, 7)*{\afvjdm{6}{\boldsymbol\epsilon}{}};
( 0, 8)*{\afaid{}{}{}{}{}{}};
( 8, 7)*{\afvjdm{6}{}{\boldsymbol{\epsilon'}}};
(-5, 0)*{\affr{8}{8}};
(-4, 2)*{\aflabelright\phi};
%---
( 5, 0)*{\affr{8}{8}};
( 6, 2)*{\aflabelright{\psi}};
( 8,-7)*{\afvjum{6}{}{\boldsymbol{\iota'}}};
( 0,-8)*{\afaiu{}{}{}{}{}{}};
(-8,-7)*{\afvjum{6}{\boldsymbol\iota}{}};
}
\quad\to_\frpb\quad
\atomicflow
{
%%%%% RED %%%%%
(0,-20)="D";
(0,-10)="Dhalf";
%% contractions
"D"+"D"="A";
%left
"A"+(-14,-15.5)-"D"*{\afvjmcol{23}{Red}};
"A"+(-11,-17)*{\afvjumcol{4}{\boldsymbol\iota}{}{Red}};
%right
"A"+(11,-11.5)-"Dhalf"*{\afvjmcol{11}{Red}};
"A"+(14,-15.5)-"D"*{\afvjmcol{23}{Red}};
"A"+(11,-17)*{\afvjumcol{4}{}{\boldsymbol{\iota'}}{Red}};
% top boxes
(0,0)="A";
"A"+(-11,-14)*{\afcjrmcol{6}{20}{Red}};
"A"+(11,-14)*{\afcjlmcol{6}{20}{Red}};
"A"+( 0,  8)*{\afaidcol{}{}{}{}{}{}{Red}{Red}};
"A"+(-2, -8)*{\afawucol{}{}{}{}{}{Red}};
% join one
"A"+(2,-10)*{\afvjcol{12}{Red}};
% middle boxes
"A"+"D"="A";
"A"+(9.5,-10)*{\afcjlmcol{3}{12}{Red}};
"A"+( 2,-8)*{\afawucol{}{}{}{}{}{Red}};
%%%%% GREEN %%%%%
%% cocontractions
(0,0)="A";
%left
"A"+(-11,17)*{\afvjdmcol{4}{\boldsymbol\epsilon}{}{OliveGreen}};
"A"+"D"+(-14,15.5)*{\afvjmcol{23}{OliveGreen}};
"A"+"Dhalf"+(-11,11.5)*{\afvjmcol{11}{OliveGreen}};
%right
"A"+(11,17)*{\afvjdmcol{4}{}{\boldsymbol{\epsilon'}}{OliveGreen}};
"A"+"D"+(14,15.5)*{\afvjmcol{23}{OliveGreen}};
% middle boxes
"A"+"D"="A";
"A"+(-9.5,10)*{\afcjlmcol{3}{12}{OliveGreen}};
"A"+(-2, 8)*{\afawdcol{}{}{}{}{}{OliveGreen}};
% join two
"A"+(-2,-10)*{\afvjcol{12}{OliveGreen}};
% bottom boxes
"A"+"D"="A";
"A"+(-11,14)*{\afcjlmcol{6}{20}{OliveGreen}};
"A"+(11,14)*{\afcjrmcol{6}{20}{OliveGreen}};
"A"+( 0,-8)*{\afaiucol{}{}{}{}{}{}{OliveGreen}{OliveGreen}};
"A"+( 2, 8)*{\afawdcol{}{}{}{}{}{OliveGreen}};
%%%%% BLACK %%%%%
%% cocontractions
(0,0)="A";
%left
"A"+(-8,5.5)*{\afvjm3};
"A"+(-11,11)*{\affr88};
"A"+(-11,11)*{\copy\contrup};
%right
"A"+(8,5.5)*{\afvjm3};
"A"+"Dhalf"+(11,11.5)*{\afvjm{11}};
"A"+(11,11)*{\affr88};
"A"+(11,11)*{\copy\contrup};
%% contractions
"D"+"D"="A";
%left
"A"+(-11,-11.5)-"Dhalf"*{\afvjm{11}};
"A"+(-8,-5.5)*{\afvjm3};
"A"+(-11,-11)*{\affr88};
"A"+(-11,-11)*{\copy\contrdown};
%right
"A"+(8,-5.5)*{\afvjm3};
"A"+(11,-11)*{\affr88};
"A"+(11,-11)*{\copy\contrdown};
% top boxes
(0,0)="A";
"A"+(-5,  0)*{\affr{8}{8}};
"A"+(-6,  2)*{\aflabelright{f_1(\phi)}};
"A"+( 5,  0)*{\affr{8}{8}};
"A"+( 4,  2)*{\aflabelright{g_1(\psi)}};
% middle boxes
"A"+"D"="A";
"A"+(9.5,10)*{\afcjrm{3}{12}};
"A"+(-9.5,-10)*{\afcjrm{3}{12}};
"A"+(-5, 0)*{\affr{8}{8}};
"A"+(-6, 2)*{\aflabelright{f_2(\phi)}};
"A"+( 5, 0)*{\affr{8}{8}};
"A"+( 4, 2)*{\aflabelright{g_2(\psi)}};
% bottom boxes
"A"+"D"="A";
"A"+(-5, 0)*{\affr{8}{8}};
"A"+(-6, 2)*{\aflabelright{f_3(\phi)}};
"A"+( 5, 0)*{\affr{8}{8}};
"A"+( 4, 2)*{\aflabelright{g_3(\psi)}};
}\quad,
\]
where the evidenced interaction and cut vertices belong to the same connected component.
\end{definition}

\begin{theorem}\label{theorem:PathBreakerSound}
Reduction $\to_\frpb$ is sound.
\end{theorem}

\begin{proof}
Let $\Phi$ be a derivation with flow $\phi'$, such that $\phi'\to_\frpb\psi'$. We show that there exists a derivation $\Psi$ with flow $\psi'$ and with the same premiss and conclusion as $\Phi$. In the following, we refer to the figure in Definition~\vref{definition:PathBreaker}.

Since the evidenced interaction and cut vertices belong to the same connected component, we assume, using Remark~\vref{remark:AlternativeAiDecomposedForm}, that the following derivation is an $\ai$-decomposed form of $\Phi$:
\[
\vlder{\Phi'}{}
{
 \vlsbr[\beta\;.\;\vlinf{}{}{\fff}{\vls(a^\phi.\bar a^\psi)}]
}
{
 \vlsbr(\vlinf{}{}{\vls[a^\phi.\bar a^\psi]}{\ttt}\;.\;\alpha)
}\quad,
\]
for some atom $a$ and formulae $\alpha$ and $\beta$.

We combine three copies of $\Phi'$ to obtain the desired derivation $\Psi$ with flow $\psi'$ and the same premiss and conclusion as $\Phi$:

\TODO{Make an example of this use of switches:}

\newbox\DeltaTopK
\setbox\DeltaTopK=
\hbox{$
\vlder{\Phi'}{}
{
 \vlsbr[\beta\;.\;(\vlinf{}{}{\ttt}{a^\phi}\;.\;\bar a^\psi)]
}
{
 \vlsbr(\vlinf{}{}{\vls[a^\phi.\bar a^\psi]}{\ttt}\;.\;\alpha)
}
$}
\newbox\DeltaK
\setbox\DeltaK=
\hbox{$
\vlder{\Phi'}{}
{
 \vlsbr[\beta\;.\;(a^\phi\;.\;\vlinf{}{}{\ttt}{\bar a^\psi})]
}
{
 \vlsbr([\vlinf{}{}{a^\phi}{\fff}\;.\;\bar a^\psi]\;.\;\alpha)
}
$}
\newbox\DeltaBotK
\setbox\DeltaBotK=
\hbox{$
\vlder{\Phi'}{}
{
 \vlsbr[\beta\;.\;\vlinf{}{}{\fff}{\vls(a^\phi.\bar a^\psi)}]
}
{
 \vlsbr([a^\phi\;.\;\vlinf{}{}{\bar a^\psi}{\fff}]\;.\;\alpha)
}
$}
\[
\Psi\quad=\quad
\vlderivation
{
 \vlin{\cod}{}{\beta}
 {
  \vlin{\swi}{}
  {
   \vls
   [
    \vlinf{\cod}{}{\beta}{\vls[\beta.\beta]}
   \;\;\;\;.\;\;\;\;
    \box\DeltaBotK
   ]
  }
  {
   \vlin{\swi}{}
   {
    \vls
    (
%     \vlinf{\swi}{}
%     {
%      \vls
      [
       \beta
      \;\;\;\;.\;\;\;\;
       \box\DeltaK
      ]
%     }
%     {
%      \vls(\vlsmallbrackets[\beta.\bar a^\psi].\alpha)
%     }
    \;\;\;\;\;.\;\;\;\;\;
     \alpha
    )   
   }
   {
    \vlin{\cod}{}
    {
     \vls
     (
      \box\DeltaTopK
     \;\;\;\;.\;\;\;\;
      \vlinf{\cou}{}{\vls(\alpha.\alpha)}{\alpha}
     )
    }
    {
     \vlhy{\alpha}
    }
   }
  }
 } 
}\qquad.
\]
\end{proof}

%-----------------------------------------------------
\begin{lemma}\label{lemma:PathBreaker}
Given two atomic flows $\phi$ and $\psi$, such that $\phi\to_\frpb\psi$, and given an interaction (resp., cut) vertex $\nu$ in $\psi$, then there is an interaction (resp., cut) vertex $\nu'$ in $\phi$ such that $\nu=f_1(\nu')$, $\nu=f_2(\nu')$ or $\nu=f_3(\nu')$, and
\begin{itemize}
\item if there is a path from $\nu$ to $\bot$ (resp., $\top$) in $\psi$, then there is a path from $\nu'$ to $\bot$ (resp., $\top$) in $\phi$; and
\item if there is a cut (resp., interaction) vertex $\hat\nu$ in $\psi$, such that there is a path from $\nu$ to $\hat\nu$ in $\psi$, then there is a cut (resp., interaction) vertex $\hat\nu'$ in $\phi$, such that $\hat\nu=f_1(\hat\nu')$, $\hat\nu=f_2(\hat\nu')$ or $\hat\nu=f_3(\hat\nu')$, and there is a path from $\nu'$ to $\hat\nu'$ in $\phi$.
\end{itemize}
\end{lemma}

\begin{proof}
By a case analysis on the atomic flows in Definition~\vref{definition:PathBreaker}.
\end{proof}

%----------------------------
\newcommand{\PB}{\mathsf{PB}}
\begin{definition}\label{definition:DerPathBreaker}
The \emph{Path Breaker}, $\PB$, is an operator whose arguments are an atom $a$, and a derivation of shape
\[
\Phi\;=\;
\vlder{\Phi'}{}
{
 \vlsbr
 [
  \beta
 \;.\;
  \vlinf{}{}
  {
   \fff
  }
  {
   \vls(a^\psi.\bar a)
  }
 \;.\;\cdots\;.\;
  \vlinf{}{}
  {
   \fff
  }
  {
   \vls(a^\psi.\bar a)
  }
 ]
}
{
 \vlsbr
 (
  \vlinf{}{}
  {
   \vls[a^\psi.\bar a]
  }
  {
   \ttt
  }
 \;.\;\cdots\;.\;
  \vlinf{}{}
  {
   \vls[a^\psi.\bar a]
  }
  {
   \ttt
  }
 \;.\;
  \alpha
 )
}\quad,
\]
with atomic flow
\[
\atomicflow
{
(-8, 7)*{\afvjdm{6}{\boldsymbol\epsilon}{}};
( 0, 8)*{\afaidm{}{}{}{}{}{}};
( 8, 7)*{\afvjdm{6}{}{\boldsymbol{\epsilon'}}};
(-5, 0)*{\affr{8}{8}};
(-4, 2)*{\aflabelright\phi};
%---
( 5, 0)*{\affr{8}{8}};
( 6, 2)*{\aflabelright{\psi}};
( 8,-7)*{\afvjum{6}{}{\boldsymbol{\iota'}}};
( 0,-8)*{\afaium{}{}{}{}{}{}};
(-8,-7)*{\afvjum{6}{\boldsymbol\iota}{}};
}
\quad,
\]
such that occurrences of $a$ does not appear in an interaction or cut instance in $\Phi'$. Consider the derivation
\[
\Psi'\;=\;
\vlder{\Phi'}{}
{
 \vlsbr
 [
  \beta
 \;\;\;.\;\;\;
  \vlderivation
  {
   \vlin{}{}
   {
    \fff
   }
   {
    \vlde{}{\{\cod\}}
    {
     \vls(a.\bar a)
    }
    {
     \vlhy
     {
      \vls[(a.\bar a).\cdots.(a.\bar a)]
     }
    }
   }
  }
 ]
}
{
 \vlsbr
 (
  \vlderivation
  {
   \vlde{}{\{\cou\}}
   {
    \vls([a.\bar a].\cdots.[a.\bar a])
   }
   {
    \vlin{}{}
    {
     \vls[a.\bar a]
    }
    {
     \vlhy
     {
      \ttt
     }
    }
   }
  }
 \;\;\;.\;\;\;
  \alpha
 )
}\quad,
\]
with atomic flow
\[
\psi'\;=\;
\atomicflow{
(-8, 11)*{\afvjdm{14}{\boldsymbol\epsilon}{}};
(11, 11)*{\afvjdm{14}{}{\boldsymbol{\epsilon'}}};
( 2, 18)*{\afaidex{}{}{}{}{}{}{8}{4}};
%-
(-2, 10)*{\affr68};
(-2, 10)*{\copy\contrup};
(-2,  5)*{\afvjm2};
(-5,  0)*{\affr{8}{8}};
(-1,  2)*{\aflabelleft{\phi}};
(-2, -5)*{\afvjm2};
(-2,-10)*{\affr68};
(-2,-10)*{\copy\contrdown};
%-
( 6, 10)*{\affr68};
( 6, 10)*{\copy\contrup};
( 6,  5)*{\afvjm2};
( 8,  0)*{\affr{8}{8}};
(12,  2)*{\aflabelleft{\psi}};
( 6, -5)*{\afvjm2};
( 6,-10)*{\affr68};
( 6,-10)*{\copy\contrdown};
%-
( 2,-18)*{\afaiuex{}{}{}{}{}{}{8}{4}};
(-8,-11)*{\afvjum{14}{\boldsymbol\iota}{}};
(11,-11)*{\afvjum{14}{}{\boldsymbol{\iota'}}};
}\quad.
\]
We then define $\PB(\Phi,a)$ to be such that $\Psi'\to_\frpb\PB(\Phi,a)$.
\end{definition}

%------------------------------------------------------------
\begin{proposition}\label{proposition:IsolatedSubflowRemover}
Given an atom $a$, and a derivation $\Phi$ as described in Definition~\ref{definition:DerPathBreaker},
\begin{enumerate}
\item $\PB(\Phi,a)$ is weakly streamlined with respect to $a$ and $\bar a$;
\item for any atom $b$, if $\Phi$ is weakly streamlined with respect to $b$, then $\PB(\Phi,a)$ is weakly streamlined with respect to $b$; and
\item the size of $\PB(\Phi,a)$ depends linearly on the size of\/ $\Phi$.
\end{enumerate}
\end{proposition}

\begin{proof}
The statements follow by
\begin{enumerate}
\item Definition~\vref{definition:DerStreamlined} and Lemma~\vref{lemma:PathBreaker};
\item Definitions~\ref{definition:DerStreamlined} and Lemma~\ref{lemma:PathBreaker};
\item Proposition~\vref{proposition:DerivationSubstitution}.
\end{enumerate}
\end{proof}
%--------------

\begin{example}\label{example:PathBreaker}
Given a derivation $\Phi$ with atomic flow
\[
\phi\;\;=\;\;\atomicflow
{
(-13,0)*{\affr{22}{20}};
(-5,8)*{\aflabelright{\phi_1}};
%
(-20, 9)*{\afvjm{10}};
(-13, 8)*{\afaid{}{}{}{}{}{}};
( -6, 9)*{\afvjm{10}};
(-18, 0)*{\affr{8}{8}};
(-17, 2)*{\aflabelright{\phi'_1}};
( -8, 0)*{\affr{8}{8}};
( -7, 2)*{\aflabelright{\phi''_1}};
( -6,-9)*{\afvjm{10}};
(-13,-8)*{\afaiu{}{}{}{}{}{}};
(-20,-9)*{\afvjm{10}};
%------------
(13,0)*{\affr{22}{20}};
(21,8)*{\aflabelright{\phi_2}};
%
(20, 9)*{\afvjm{10}};
(13, 8)*{\afaid{}{}{}{}{}{}};
( 6, 9)*{\afvjm{10}};
( 8, 0)*{\affr{8}{8}};
( 9, 2)*{\aflabelright{\phi'_2}};
(18, 0)*{\affr{8}{8}};
(19, 2)*{\aflabelright{\phi''_2}};
( 6,-9)*{\afvjm{10}};
(13,-8)*{\afaiu{}{}{}{}{}{}};
(20,-9)*{\afvjm{10}};
}\qquad
\atomicflow
{
(0,9)*{\afvjm{10}};
(0,0)*{\affr88};
(2,2)*{\aflabelright{\psi}};
(0,-9)*{\afvjm{10}};
}\quad,
\]
where occurrences of $a_1$ are mapped to all the edges in $\phi'_1$, occurrences of $\bar a_1$ are mapped to all the edges in $\phi''_1$, occurrences of $a_2$ are mapped to all the edges in $\phi'_2$, and occurrences of $\bar a_2$ are mapped to all the edges in $\phi''_2$; the atomic flow of $\PB(\PB(\Phi,a_1),a_2)$ is
\[
\atomicflow
{
%cocontraction - top
(12,43.5)*{\afvjm{3}};
(12,38)*{\affr{34}8};
(12,38)*{\copy\contrup};
(-18,46)*{\afaidex{}{}{}{}{}{}31};
(-24,38)*{\affr{10}8};
(-24,38)*{\copy\contrup};
(-12,38)*{\affr{10}8};
(-12,38)*{\copy\contrup};
%contraction - bot
(-12,-43.5)*{\afvjm{3}};
(-12,-38)*{\affr{34}8};
(-12,-38)*{\copy\contrdown};
(18,-46)*{\afaiuex{}{}{}{}{}{}31};
(24,-38)*{\affr{10}8};
(24,-38)*{\copy\contrdown};
(12,-38)*{\affr{10}8};
(12,-38)*{\copy\contrdown};
%---------------------
(4,-20)="D";
(0,-10)="Dhalf";
%----------------
%%first
(-20,0)="B";
% cocontractions
"B"-"D"-"D"-(-12,7)="A";
"A"+(4,-4)*{\afcjrm{16}{10}};
"A"+(8,-4)*{\afcjrm{16}{10}};
"A"+(12,-4)*{\afcjrm{16}{10}};
"A"+"Dhalf"+"Dhalf"+(4,-9)*{\afvjm{40}};
"A"+"Dhalf"+(0,-9)*{\afvjm{20}};
"A"+(-12,-4)*{\afvj{10}};
"A"+(-4,-4)*{\afcjr{8}{10}};
% contractions
"B"+"D"+"D"+(-12,7)="A";
"A"+(4,4)*{\afvjm{10}};
"A"+(0,4)-"Dhalf"*{\afvjm{30}};
"A"+(-4,4)-"Dhalf"-"Dhalf"*{\afvjm{50}};
"A"-(-20,-4)*{\afcjl{24}{10}};
"A"-(-28,-4)*{\afcjl{32}{10}};
%---
% top boxes
"B"-"D"="A";
"A"+( 0,-8)*{\afawu{}{}{}{}{}};
"A"+( 0, 0)*{\affr{10}{8}};
"A"+( 2, 2)*{\aflabelright{\phi_1}};
% join one
"A"+(4,-10)*{\afvjcol{12}{Red}};
% middle boxes
"B"="A";
"A"+(-4, 8)*{\afawd{}{}{}{}{}};
"A"+( 4,-8)*{\afawu{}{}{}{}{}};
"A"+( 0, 0)*{\affr{10}{8}};
"A"+( 2, 2)*{\aflabelright{\phi_1}};
% join two
"A"+(0,-10)*{\afvjcol{12}{Red}};
% bottom boxes
"B"+"D"="A";
"A"+(0, 8)*{\afawd{}{}{}{}{}};
"A"+(0, 0)*{\affr{10}{8}};
"A"+( 2, 2)*{\aflabelright{\phi_1}};
%----------------
%%second
(0,0)="B";
% cocontractions
"B"-"D"-"D"-(-12,7)="A";
"A"+(0,-4)*{\afcjrm8{10}};
"A"+(4,-4)*{\afcjrm8{10}};
"A"+(8,-4)*{\afcjrm8{10}};
"A"+"Dhalf"+"Dhalf"+(4,-9)*{\afvjm{40}};
"A"+"Dhalf"+(0,-9)*{\afvjm{20}};
"A"+(-20,-4)*{\afcjl{16}{10}};
"A"+(-12,-4)*{\afcjl{8}{10}};
% contractions
"B"+"D"+"D"+(-12,7)="A";
"A"-(0,-4)*{\afcjrm8{10}};
"A"-(4,-4)*{\afcjrm8{10}};
"A"-(8,-4)*{\afcjrm8{10}};
"A"-"Dhalf"-"Dhalf"-(4,-9)*{\afvjm{40}};
"A"-"Dhalf"-(0,-9)*{\afvjm{20}};
"A"-(-20,-4)*{\afcjl{16}{10}};
"A"-(-12,-4)*{\afcjl{8}{10}};
%---
% top boxes
"B"-"D"="A";
"A"+( 0,-8)*{\afawu{}{}{}{}{}};
"A"+( 0, 0)*{\affr{10}{8}};
"A"+( 2, 2)*{\aflabelright{\phi_1}};
% join one
"A"+(4,-10)*{\afvjcol{12}{Red}};
% middle boxes
"B"="A";
"A"+(-4, 8)*{\afawd{}{}{}{}{}};
"A"+( 4,-8)*{\afawu{}{}{}{}{}};
"A"+( 0, 0)*{\affr{10}{8}};
"A"+( 2, 2)*{\aflabelright{\phi_1}};
% join two
"A"+(0,-10)*{\afvjcol{12}{Red}};
% bottom boxes
"B"+"D"="A";
"A"+(0, 8)*{\afawd{}{}{}{}{}};
"A"+(0, 0)*{\affr{10}{8}};
"A"+( 2, 2)*{\aflabelright{\phi_1}};
%----------------
%%third
(20,0)="B";
% cocontractions
"B"-"D"-"D"-(-12,7)="A";
"A"+"Dhalf"+"Dhalf"+(4,-4)*{\afvjm{50}};
"A"+"Dhalf"+(0,-4)*{\afvjm{30}};
"A"+(-4,-4)*{\afvjm{10}};
"A"+(-20,-4)*{\afcjl{24}{10}};
"A"+(-28,-4)*{\afcjl{32}{10}};
% contractions
"B"+"D"+"D"+(-12,7)="A";
"A"-(4,-4)*{\afcjrm{16}{10}};
"A"-(8,-4)*{\afcjrm{16}{10}};
"A"-(12,-4)*{\afcjrm{16}{10}};
"A"-"Dhalf"-"Dhalf"-(4,-9)*{\afvjm{40}};
"A"-"Dhalf"-(0,-9)*{\afvjm{20}};
"A"-(-12,-4)*{\afvj{10}};
"A"-(-4,-4)*{\afcjr{8}{10}};
%---
% top boxes
"B"-"D"="A";
"A"+( 0,-8)*{\afawu{}{}{}{}{}};
"A"+( 0, 0)*{\affr{10}{8}};
"A"+( 2, 2)*{\aflabelright{\phi_1}};
% join one
"A"+(4,-10)*{\afvjcol{12}{Red}};
% middle boxes
"B"="A";
"A"+(-4, 8)*{\afawd{}{}{}{}{}};
"A"+( 4,-8)*{\afawu{}{}{}{}{}};
"A"+( 0, 0)*{\affr{10}{8}};
"A"+( 2, 2)*{\aflabelright{\phi_1}};
% join two
"A"+(0,-10)*{\afvjcol{12}{Red}};
% bottom boxes
"B"+"D"="A";
"A"+(0, 8)*{\afawd{}{}{}{}{}};
"A"+(0, 0)*{\affr{10}{8}};
"A"+( 2, 2)*{\aflabelright{\phi_1}};
}
\]
\[
\atomicflow
{
(12,-52)="D";
% cocontractions
(18,-11)="A";
%
"A"+(6,5.5)*{\afvjm3};
"A"+(6,0)*{\affr{34}8};
"A"+(6,0)*{\copy\contrup};
"A"+(2,-30)*{\afvjm{52}};
"A"+(6,-30)*{\afvjm{52}};
"A"+(10,-34)*{\afvjm{60}};
"A"+(14,-56)*{\afvjm{104}};
"A"+(18,-56)*{\afvjm{104}};
"A"+(22,-60)*{\afvjm{112}};
% === BOX ONE ===
(0,-27)="A";
%-
"A"+( -6,24)*{\afaidex{}{}{}{}{}{}31};
%-
"A"+(-12,16)*{\affr{10}8};
"A"+(-12,16)*{\copy\contrup};
"A"+(  0,16)*{\affr{10}8};
"A"+(  0,16)*{\copy\contrup};
%-
"A"+(-16,8)*{\afvj8};
"A"+(-8,8)*{\afcjr88};
"A"+(0,8)*{\afcjrm{16}8};
%
"A"+(-8,8)*{\afcjl88};
"A"+(0,8)*{\afvj8};
"A"+(8,8)*{\afcjrm88};
%
"A"+(0,8)*{\afcjl{16}8};
"A"+(8,8)*{\afcjl88};
"A"+(16,8)*{\afvjm8};
%-
"A"+(-12,0)*{\affr{10}8};
"A"+(0,0)*{\affr{10}8};
"A"+(12,0)*{\affr{10}8};
"A"+(-10,2)*{\aflabelright{\phi_2}};
"A"+(2,2)*{\aflabelright{\phi_2}};
"A"+(14,2)*{\aflabelright{\phi_2}};
%-
"A"+(-8,-8)*{\afcjl88};
"A"+(0,-8)*{\afcjlcol{16}8{Red}};
%-
"A"+(-8,-8)*{\afcjrm88};
"A"+(0,-8)*{\afvj8};
"A"+(8,-8)*{\afcjlcol88{Red}};
%
"A"+(0,-8)*{\afcjrm{16}8};
"A"+(8,-8)*{\afcjr88};
"A"+(16,-8)*{\afvjcol8{Red}};
%
"A"+(  0,-16)*{\affr{10}8};
"A"+(  0,-16)*{\copy\contrdown};
"A"+( 12,-16)*{\affr{10}8};
"A"+( 12,-16)*{\copy\contrdown};
%---
"A"+(0,-24)*{\afawu{}{}{}{}};
"A"+(12,-26)*{\afvjcol{12}{Red}};
% === BOX TWO ===
"A"+"D"="A";
%-
"A"+(-12,24)*{\afawd{}{}{}{}};
%-
"A"+(-12,16)*{\affr{10}8};
"A"+(-12,16)*{\copy\contrup};
"A"+(  0,16)*{\affr{10}8};
"A"+(  0,16)*{\copy\contrup};
%-
"A"+(-16,8)*{\afvj8};
"A"+(-8,8)*{\afcjrcol88{Red}};
"A"+(0,8)*{\afcjrm{16}8};
%
"A"+(-8,8)*{\afcjl88};
"A"+(0,8)*{\afvjcol8{Red}};
"A"+(8,8)*{\afcjrm88};
%
"A"+(0,8)*{\afcjl{16}8};
"A"+(8,8)*{\afcjlcol88{Red}};
%-
"A"+(-12,0)*{\affr{10}8};
"A"+(0,0)*{\affr{10}8};
"A"+(12,0)*{\affr{10}8};
"A"+(-10,2)*{\aflabelright{\phi_2}};
"A"+(2,2)*{\aflabelright{\phi_2}};
"A"+(14,2)*{\aflabelright{\phi_2}};
%-
"A"+(-8,-8)*{\afcjlcol88{Red}};
"A"+(0,-8)*{\afcjl{16}8};
%-
"A"+(-8,-8)*{\afcjrm88};
"A"+(0,-8)*{\afvjcol8{Red}};
"A"+(8,-8)*{\afcjl88};
%
"A"+(0,-8)*{\afcjrm{16}8};
"A"+(8,-8)*{\afcjrcol88{Red}};
"A"+(16,-8)*{\afvj8};
%
"A"+(  0,-16)*{\affr{10}8};
"A"+(  0,-16)*{\copy\contrdown};
"A"+( 12,-16)*{\affr{10}8};
"A"+( 12,-16)*{\copy\contrdown};
%---
"A"+(12,-24)*{\afawu{}{}{}{}};
"A"+(0,-26)*{\afvjcol{12}{Red}};
% === BOX THREE ===
"A"+"D"="A";
%-
"A"+(  0,24)*{\afawd{}{}{}{}};
%-
"A"+(-12,16)*{\affr{10}8};
"A"+(-12,16)*{\copy\contrup};
"A"+(  0,16)*{\affr{10}8};
"A"+(  0,16)*{\copy\contrup};
%-
"A"+(-16,8)*{\afvjcol8{Red}};
"A"+(-8,8)*{\afcjr88};
"A"+(0,8)*{\afcjrm{16}8};
%
"A"+(-8,8)*{\afcjlcol88{Red}};
"A"+(0,8)*{\afvj8};
"A"+(8,8)*{\afcjrm88};
%
"A"+(0,8)*{\afcjlcol{16}8{Red}};
"A"+(8,8)*{\afcjl88};
%-
"A"+(-12,0)*{\affr{10}8};
"A"+(0,0)*{\affr{10}8};
"A"+(12,0)*{\affr{10}8};
"A"+(-10,2)*{\aflabelright{\phi_2}};
"A"+(2,2)*{\aflabelright{\phi_2}};
"A"+(14,2)*{\aflabelright{\phi_2}};
%-
"A"+(-16,-8)*{\afvjm8};
"A"+(-8,-8)*{\afcjl88};
"A"+(0,-8)*{\afcjl{16}8};
%-
"A"+(-8,-8)*{\afcjrm88};
"A"+(8,-8)*{\afcjl88};
"A"+(0,-8)*{\afvj8};
%
"A"+(0,-8)*{\afcjrm{16}8};
"A"+(8,-8)*{\afcjr88};
"A"+(16,-8)*{\afvj8};
%
"A"+(  0,-16)*{\affr{10}8};
"A"+(  0,-16)*{\copy\contrdown};
"A"+( 12,-16)*{\affr{10}8};
"A"+( 12,-16)*{\copy\contrdown};
%-
"A"+(  6,-24)*{\afaiuex{}{}{}{}{}{}31};
% contractions
"A"+(-20,-16)="A";
"A"+(-20,60)*{\afvjm{112}};
"A"+(-16,56)*{\afvjm{104}};
"A"+(-12,56)*{\afvjm{104}};
"A"+(-8,34)*{\afvjm{60}};
"A"+(-4,30)*{\afvjm{52}};
"A"+( 0,30)*{\afvjm{52}};
"A"+(-4,0)*{\affr{34}8};
"A"+(-4,0)*{\copy\contrdown};
"A"+(-4,-5.5)*{\afvjm3};
}
\]
\[
\atomicflow{
(0,34.5)*{\afvjm3};
(0,29)*{\affr{82}8};
(0,29)*{\copy\contrup};
%
(0,-29)*{\affr{82}8};
(0,-29)*{\copy\contrdown};
(0,-34.5)*{\afvjm3};
%-------------------
(30,0)="B";
%---------------
(0,0)-"B"="A";
"A"+(-10,14.5)*{\afvjm{21}};
"A"+(0,14.5)*{\afvjm{21}};
"A"+(10,14.5)*{\afvjm{21}};
%---
"A"+(-10,0)*{\affr88};
"A"+( -9,2)*{\aflabelright\psi};
"A"+(  0,0)*{\affr88};
"A"+(  1,2)*{\aflabelright\psi};
"A"+( 10,0)*{\affr88};
"A"+( 11,2)*{\aflabelright\psi};
%---
"A"+(-10,-14.5)*{\afvjm{21}};
"A"+(0,-14.5)*{\afvjm{21}};
"A"+(10,-14.5)*{\afvjm{21}};
%---------------
(0,0)="A";
%---
"A"+(-10,14.5)*{\afvjm{21}};
"A"+(0,14.5)*{\afvjm{21}};
"A"+(10,14.5)*{\afvjm{21}};
%---
"A"+(-10,0)*{\affr88};
"A"+( -9,2)*{\aflabelright\psi};
"A"+(  0,0)*{\affr88};
"A"+(  1,2)*{\aflabelright\psi};
"A"+( 10,0)*{\affr88};
"A"+( 11,2)*{\aflabelright\psi};
%---
"A"+(-10,-14.5)*{\afvjm{21}};
"A"+(0,-14.5)*{\afvjm{21}};
"A"+(10,-14.5)*{\afvjm{21}};
%---------------
"A"+"B"="A";
%---
"A"+(-10,14.5)*{\afvjm{21}};
"A"+(0,14.5)*{\afvjm{21}};
"A"+(10,14.5)*{\afvjm{21}};
%---
"A"+(-10,0)*{\affr88};
"A"+( -9,2)*{\aflabelright\psi};
"A"+(  0,0)*{\affr88};
"A"+(  1,2)*{\aflabelright\psi};
"A"+( 10,0)*{\affr88};
"A"+( 11,2)*{\aflabelright\psi};
%---
"A"+(-10,-14.5)*{\afvjm{21}};
"A"+(0,-14.5)*{\afvjm{21}};
"A"+(10,-14.5)*{\afvjm{21}};
}\quad.
\]
By comparing the copies of $\phi_1$ with the copies of $\phi_2$ in $\PB(\PB(\Phi,a_1),a_2)$ we can see why the procedure is non-confluent. We could trivially change our procedure to make the subflows more similar by permuting the weakening (resp., coweakening) vertices down (resp., up) in the second subflow. However, the subflows marked in red will still differ.
\end{example}