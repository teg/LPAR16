\TODO{Throughout: use `isolated subflow' and define it somewhere else.}

\newcommand{\fris}{{\mathsf{is}}}
%---------------------------------------
\begin{definition}\label{definition:IsolatedSubflowRemoval}
We define the reduction $\to_\fris$ (where $\fris$ stands for \emph{isolated subflow}) as follows, for any atomic flow $\phi$ and any connected atomic flow $\psi$:
\[
\atomicflow{
(-8, 6)*{\afvjdm4{}{\boldsymbol\epsilon}};
( 1, 8)*{\afaidex{}{}{}{}{}{}{6}{4}};
(-5, 0)*{\affr{8}{8}};
(-4, 2)*{\aflabelright{\phi}};
( 4, 0)*{\affr{6}{8}};
( 4, 2)*{\aflabelright{\psi}};
( 1,-8)*{\afaiuex{}{}{}{}{}{}{6}{4}};
(-8,-6)*{\afvjum4{}{\boldsymbol\iota}};
}
\quad\to_\fris\quad
\atomicflow{
( 0, 16.5)*{\afacumexsq{f_2(\boldsymbol\epsilon)}{}{}{f_1(\boldsymbol\epsilon)}{}{}{12}{4}};
(-6,  4  )*{\afvjm{12}};
( 0, 14  )*{\afawd{}{}{}{}};
( 3,  6  )*{\affr{8}{8}};
( 2,  8  )*{\aflabelright{f_1(\phi)}};
( 0,  0  )*{\afvj4};
(-3, -6  )*{\affr{8}{8}};
(-4, -4  )*{\aflabelright{f_2(\phi)}};
( 0,-14  )*{\afawu{}{}{}{}};
( 6, -4  )*{\afvjm{12}};
( 0,-16  )*{\afacdmexsq{f_2(\boldsymbol\iota)}{}{}{f_1(\boldsymbol\iota)}{}{}{12}{4}};
}\quad,
\]
where, for every $\epsilon$ in $\boldsymbol\epsilon$ (reps., $\iota$ in $\boldsymbol\iota$) the edges $f_1(\epsilon)$ and $f_2(\epsilon)$ (resp., $f_1(\iota)$ and $f_2(\iota)$) are joined by a cocontraction (resp., contraction) vertex.
\end{definition}

%---------------------------------------
\begin{theorem}\label{theorem:SoundIsolatedSubflowRemoval}
Reduction\/ $\to_\fris$ is sound.
\end{theorem}

\TODO{Is it ok to refer to the definition in this way and then use the labels we defined there? (this is the way it was done in the paper).}

%---------------------------------------
\begin{proof}
Let $\Phi$ be a derivation with flow $\phi'$, such that $\phi'\to_\fris\psi'$. We show that there exists a derivation $\Psi$ with flow $\psi'$ and with the same premiss and conclusion as $\Phi$. In the following, we refer to the figure in Definition~\vref{definition:IsolatedSubflowRemoval}.

Since $\psi$ is connected, we assume, using Remark~\vref{remark:AlternativeAiDecomposedForm}, that the following derivation is an $\ai$-decomposed form of $\Phi$:
\[
\vlder{\Phi'}{}
{
 \vlsbr[\beta\;.\;\vlinf{}{}{\fff}{\vls(a.\bar a^\psi)}]
}
{
 \vlsbr(\vlinf{}{}{\vls[a.\bar a^\psi]}{\ttt}\;.\;\alpha)
}\quad,
\]
for some atom $a$ and formulae $\alpha$ and $\beta$.

We obtain the two derivations $\Phi_\ttt$ and $\Phi_\fff$ from $\Phi'$ as follows:
\[
\Phi_\ttt\;=\;
\vlder{\Phi'\{a^\psi/\fff, \bar a^\psi/\ttt\}}{}
{
 \vls[\beta.a]
}
{
 \vls([a.\ttt].\alpha)
}
\quad\mbox{and}\quad
\Phi_\fff\;=\;
\vlder{\Phi'\{a^\psi/\ttt, \bar a^\psi/\fff\}}{}
{
 \vls[\beta.(a.\fff)]
}
{
 \vls(a.\alpha)
}\quad.
\]
Since $\psi$ is connected, the mapping from occurrences of $a^\psi$ and $\bar a^\psi$ to edges of $\psi$ is surjective. Hence, we know that both derivation $\Phi_\ttt$ and $\Phi_\fff$ have flow $\phi$. We combine $\Phi_\ttt$ and $\Phi_\fff$ to get the desired derivation $\Psi$ with flow $\psi'$ and the same premiss and conclusion as $\Phi$:
\[
\Psi\;=\;
\vlderivation
{
 \vlin{\cod}{}
 {
  \beta
 }
 {
  \vlin{\swi}{}
  {
   \vls
   [
    \beta
   \;\;\;.\;\;\;
    \vlder{\Phi_\fff}{}
    {
     \vlsbr[\beta\;.\;(\vlinf{}{}{\ttt}{a}\;.\;\fff)]
    }
    {
     \vls(a.\alpha)
    }
   ]
  }
  {
   \vlin{\cou}{}
   {
    \vls
    (
     \vlder{\Phi_\ttt}{}
     {
      \vls[\beta.a]
     }
     {
      \vlsbr([\vlinf{}{}{a}{\fff}\;.\;\ttt]\;.\;\alpha)
     }
    \;\;\;.\;\;\;
     \alpha
    )
   }
   {
    \vlhy{\alpha}
   }
  }
 }
}\quad.
\]
\end{proof}

\begin{lemma}\label{lemma:IsolatedSubflowRemovalStreamlining}
Given a polarity assignment $\pi$, and two atomic flows $\phi$ and $\psi$ such that $\phi\to_\fris\psi$ and $\phi$ is weakly streamlined with respect to $\pi$ then $\psi$ is weakly streamlined with respect to $\pi$.
\end{lemma}