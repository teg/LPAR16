\chapter{Propositional Classical Logic}\label{chapter:PropositionalClassicalLogic}

\section{The Functorial Calculus}\label{section:FunctorialCalculus}

\TODO{Give credit to Francois for the name.}

\TODO{Definitions~\vrefrange{definition:Formula}{definition:InferenceRuleInstance} and Definition~\vref{definition:CoS} is taken from \emph{On the Proof Complexity of Deep Inference}.}

\TODO{Note: Removed negated formula variables; DeMorgan dual of formulae; formula variables from the examples.} 

\newcommand{\fff}{\mathsf f}
\newcommand{\ttt}{\mathsf t}
\newcommand{\size}[1]{{\left\vert #1\right\vert}}\vlupdate\size

\begin{definition}\label{definition:Formula}
We define a set of \emph{formulae}, denoted by $\alpha$, $\beta$, $\gamma$, $\delta$ to be:
\begin{itemize}
 \item \emph{atoms}, denoted by $a$, $b$, $c$, $d$ and $\bar a$, $\bar b$, $\bar c$, $\bar d$;
 \item \emph{formula variables}, denoted by $A$, $B$, $C$, $D$;
 \item \emph{units} $\fff$ (false) and $\ttt$ (true); and
 \item the \emph{disjunction} and \emph{conjunction} of formulae $\alpha$ and $\beta$, denoted by $\vlsbr[\alpha.\beta]$ and  $\vlsbr(\alpha.\beta)$, respectively.
\end{itemize}
A formula is \emph{ground} if it contains no variables. We usually omit external brackets of formulae, and sometimes we omit dispensable brackets under associativity. We use $\equiv$ to denote literal equality of formulae. The \emph{size} $\size\alpha$ of a formula $\alpha$ is the number of unit, atom and variable occurrences appearing in it. On the set of atoms there is an involution $\bar\cdot$, called \emph{negation} (\emph{i.e.}, $\bar\cdot$ is a bijection from the set of atoms to itself such that $\bar{\bar a}\equiv a$); we require that $\bar a\not\equiv a$ for every $a$; when both $a$ and $\bar a$ appear in a formula, we mean that atom $a$ is mapped to by $\bar a$ by $\bar\cdot$. A \emph{context} is a formula where one \emph{hole} $\vlhole$ appears in the place of a subformula; for example, $\vls[a.(b.\vlhole)]$ is a context; the generic context is denoted by $\xi\vlhole$. The hole can be filled with formulae; for example, if $\xi\vlhole\equiv\vls(b.[\vlhole.c])$, then $\xi\{a\}\equiv\vls(b.[a.c])$, $\xi\{b\}\equiv\vls(b.[b.c])$ and $\xi\{\vls(a.b)\}\equiv\vls(b.[(a.b).c])$. The \emph{size} of $\xi\vlhole$ is defined as $\size{\xi\vlhole}=\size{\xi\{a\}}-1$.
\end{definition}

\TODO{Note: I removed mention of $\rho$ and $\sigma$ as well as DeMorgan duals. I changed the example.}

\TODO{Negated variables?}

\begin{definition}\label{definition:RenamingSubstitution}
A \emph{renaming} is a map from the set of atoms to itself, and it is denoted by $\{a_1/b_1,a_2/b_2,\dots\}$. A renaming of $\alpha$ by $\{a_1/b_1,a_2/b_2,\dots\}$ is indicated by $\alpha\{a_1/b_1,a_2/b_2,\dots\}$ and is obtained by simultaneously substituting every occurrence of $a_i$ in $\alpha$ by $b_i$ and every occurrence of $\bar a_i$ by $\bar b_i$; for example, if $\alpha\equiv\vls(a.[b.(a.[\bar a.c])])$ then $\alpha\{a/\bar b,\bar b/c\}\equiv\vls(\bar b.[\bar c.(\bar b.[b.c])])$. A \emph{substitution} is a map from the set of formula variables to the set of formulae, denoted by $\{A_1/\beta_1,A_2/\beta_2,\dots\}$. An \emph{instance} of $\alpha$ by $\{A_1/\beta_1,A_2/\beta_2,\dots\}$ is indicated by $\alpha\{A_1/\beta_1,A_2/\beta_2,\dots\}$ and is obtained by simultaneously substituting every occurrence of variable $A_i$ in $\alpha$ by formula $\beta_i$; for example if $\alpha\equiv\vls[A.(b.c)]$ then $\alpha\{A/\vlsbr(c.\bar b)\}\equiv\vls[(c.\bar b).(b.c)]$.
\end{definition}

\TODO{Note: forced all derivations to only contain ground formulae.}

\begin{definition}\label{definition:InferenceRuleInstance}
An \emph{inference rule} $\rho$ is an expression $\vlinf{\rho}{}{\beta}{\alpha}$, where the formulae $\alpha$ and $\beta$ are called \emph{premiss} and \emph{conclusion}, respectively. A (\emph{deductive}) \emph{system} is a finite set of inference rules. An \emph{inference rule instance} $\vlinf{\rho}{}{\delta}{\gamma}$ of $\vlinf{\rho}{}{\beta}{\alpha}$ is such that $\gamma$ and $\delta$ are ground, and $\gamma\equiv\alpha\{a_1/b_1,a_2/b_2,\dots\}\{A_1/\beta_1,A_2/\beta_2,\dots\}$ and $\delta\equiv\beta\{a_1/b_1,a_2/b_2,\dots\}\{A_1/\beta_1,A_2/\beta_2,\dots\}$, for some renaming $\{a_1/b_1,a_2/b_2,\dots\}$ and substiution $\{A_1/\beta_1,A_2/\beta_2,\dots\}$.
\end{definition}

\begin{definition}\label{definition:Derivation}
Given a deductive system $\mathcal S$, and formulae $\alpha$ and $\beta$; a (\emph{functorial calculus}) \emph{derivation $\Psi$ in $\mathcal S$ from $\alpha$ to $\beta$}, denoted $\vlder{\Psi}{\mathcal{S}}{\beta}{\alpha}$, is defined to be
\begin{enumerate}
 \item\label{definition:Derivation:item:Formula} a formula: $\Psi\;=\;\alpha\equiv\beta$;

 \item\label{definition:Derivation:item:Vertical} a \emph{vertical composition}:
 \[
 \Psi\;=\;
 \vlderivation
 {
  \vlde{\Phi_2}{}
  {
   \beta
  }
  {
   \vlin{\rho}{}
   {
    \alpha'
   }
   {
    \vlde{\Phi_1}{}
    {
     \beta'
    }
    {
     \vlhy
     {
      \alpha
     }
    }
   }
  }
 }
 \quad,
 \]
 where $\vlinf{\rho}{}{\alpha'}{\beta'}$ is an instance of an inference rule from $\mathcal{S}$, and $\vlder{\Phi_1}{\mathcal S}{\beta'}{\alpha}$ and $\vlder{\Phi_2}{\mathcal S}{\beta}{\alpha'}$ are derivations; or

 \item\label{definition:Derivation:item:Horizontal} a \emph{horizontal composition}:
 \[
 \Psi\;=\;
 \vls
 (
  \vlder{\Phi_1}{}{\beta_1}{\alpha_1}
 \;\;.\;\;
  \vlder{\Phi_2}{}{\beta_2}{\alpha_2}
 )
 \qquad\mbox{or}\qquad
 \Psi\;=\;
 \vls
 [
  \vlder{\Phi_1}{}{\beta_1}{\alpha_1}
 \;\;.\;\;
  \vlder{\Phi_2}{}{\beta_2}{\alpha_2}
 ] 
 \quad,
 \]
 where $\vlder{\Phi_1}{}{\beta_1}{\alpha_1}$ and $\vlder{\Phi_2}{}{\beta_2}{\alpha_2}$ are derivations, and  $\alpha\equiv\vls[\alpha_1.\alpha_2]$ and $\beta\equiv\vls[\beta_1.\beta_2]$, or $\alpha\equiv\vls(\alpha_1.\alpha_2)$ and $\beta\equiv\vls(\beta_1.\beta_2)$, respectively.
\end{enumerate}
The size of a derivation $\Psi$, denoted $\size{\Psi}$, is defined to be the sum of the size of the formulae appearing in $\Psi$.
\end{definition}

\begin{remark}\label{remark:DerAssociativeComposition}
Given derivations $\vlder{\Phi_1}{}{\beta_1}{\alpha_1}$, $\vlder{\Phi_2}{}{\beta_2}{\alpha_2}$ and $\vlder{\Phi_3}{}{\beta_3}{\alpha_3}$, and inference rule instances $\vlinf{\rho_1}{}{\alpha_2}{\beta_1}$ and $\vlinf{\rho_2}{}{\alpha_3}{\beta_2}$ we consider
\[
\vlinf{\rho_2}{}
{
 \vlder{\Phi_3}{}
 {
  \beta_3
 }
 {
  \alpha_3
 }
}
{
 \left(
 \vlinf{\rho_1}{}
 {
  \vlder{\Phi_2}{}
  {
   \beta_2
  }
  {
   \alpha_2
  }
 }
 {
  \vlder{\Phi_1}{}
  {
   \beta_1
  }
  {
   \alpha_1
  }
 }
 \right)
}
\quad\mbox{and}\quad
\vlinf{\rho_1}{}
{
 \left(
 \vlinf{\rho_2}{}
 {
  \vlder{\Phi_3}{}
  {
   \beta_3
  }
  {
   \alpha_3
  }
 }
 {
  \vlder{\Phi_2}{}
  {
   \beta_2
  }
  {
   \alpha_2
  }
 }
 \right)
}
{
 \vlder{\Phi_1}{}
 {
  \beta_1
 }
 {
  \alpha_1
 }
}
\]
to be equal, and we denote them both by
\[
\vlderivation
{
 \vlde{\Phi_3}{}
 {
  \beta_3
 }
 {
  \vlin{\rho_2}{}
  {
   \alpha_3
  }
  {
   \vlde{\Phi_2}{}
   {
    \beta_2
   }
   {
    \vlin{\rho_1}{}
    {
     \alpha_2
    }
    {
     \vlde{\Phi_1}{}
     {
      \beta_1
     }
     {
      \vlhy
      {
       \alpha_1
      }
     }
    }
   }
  }
 }
}
\quad.
\]
\end{remark}

\begin{lemma}\label{lemma:DerInContext}
Given a derivation $\vlder{\Phi}{}{\beta}{\alpha}$ and a context $\xi\vlhole$, a derivation $\vlder{\Psi}{}{\xi\{\beta\}}{\xi\{\alpha\}}$, with size $\size{\Phi}+\size{\xi\vlhole}$, can be constructed.
\end{lemma}

\begin{proof}
We proceed by structural induction on $\xi\vlhole$. The base case, $\xi\vlhole\equiv\vlhole$, is trivial.
For the inductive case, let
\[
 \xi\vlhole\equiv r(\gamma_1,\dots,\gamma_{i-1},\xi'\vlhole,\gamma_{i+1},\dots,\gamma_n)
\]
for some $n$-ary logical relation $r$, some formulae $\gamma_1$, $\dots$, $\gamma_{i-1}$, $\gamma_{i+1}$, $\dots$, $\gamma_n$ and a context $\xi'\vlhole$. By the inductive hypothesis we can construct the derivation $\vlder{\Psi'}{}{\xi'\{\beta\}}{\xi'\{\alpha\}}$, so the result follows by case \ref{definition:Derivation:item:Horizontal} of Definition~\vref{definition:Derivation}.
\end{proof}

\begin{definition}\label{definition:DerInContext}
Given a derivation $\vlder{\Phi}{}{\beta}{\alpha}$ and a context $\xi\vlhole$, the derivation $\vlder{}{}{\xi\{\beta\}}{\xi\{\alpha\}}$ constructed in the proof of Lemma~\vref{lemma:DerInContext} is denoted $\xi\{\Phi\}$.
\end{definition}

\begin{lemma}\label{lemma:DerComposition}
Given two derivations $\vlder{\Phi_1}{}{\beta}{\alpha}$ and $\vlder{\Phi_2}{}{\gamma}{\beta}$, a derivation $\vlder{\Psi}{}{\gamma}{\alpha}$, with size $\size{\Phi_1}+\size{\Phi_2}-\size{\beta}$, can be constructed.
\end{lemma}

\begin{proof}
We argue by structural induction on $\Phi_1$
\begin{enumerate}

 \item\label{proof:DerComposition:item:Formula} if $\Phi_1=\beta$ then $\Psi=\Phi_2$, with size $\size{\Phi_1}+\size{\Phi_2}-\size{\beta}$;

 \item\label{proof:DerComposition:item:Vertical} if
  \[
   \Phi_1\;=\;
   \vlderivation
   {
    \vlde{\Phi''_1}{}
    {
     \beta
    }
    {
     \vlin{\rho}{}
     {
      \alpha'
     }
     {
      \vlde{\Phi'_1}{}
      {
       \beta'
      }
      {
       \vlhy
       {
        \alpha
       }
      }
     }
    }
   }\quad,
  \]
  then, by the inductive hypothesis, we can construct $\vlder{\Psi'}{}{\gamma}{\alpha'}$, with size $\size{\Phi''_1}+\size{\Phi_2}-\size{\beta}$, we can then build
  \[
   \Psi\;=\;
   \vlderivation
   {
    \vlde{\Psi'}{}
    {
     \gamma
    }
    {
     \vlin{\rho}{}
     {
      \alpha'
     }
     {
      \vlde{\Phi'_1}{}
      {
       \beta'
      }
      {
       \vlhy
       {
        \alpha
       }
      }
     }
    }
   }\quad,
  \]
  with size $\size{\Phi'_1}+\size{\Psi'}=\size{\Phi'_1}+\size{\Phi''_1}+\size{\Phi_2}-\size{\beta}=\size{\Phi_1}+\size{\Phi_2}-\size{\beta}$;

% \item if
%  \[
%   \Phi_2\;=\;
%   \vlderivation
%   {
%    \vlde{\Phi''_2}{}
%    {
%     \gamma
%    }
%    {
%     \vlin{\rho}{}
%     {
%      \beta'
%     }
%     {
%      \vlde{\Phi'_2}{}
%      {
%       \gamma'
%      }
%      {
%       \vlhy
%       {
%        \beta
%       }
%      }
%     }
%    }
%   }\quad,
%  \]
%  then, by the inductive hypothesis, we can construct $\vlder{\Psi'}{}{\gamma'}{\alpha}$, with size $\size{\Phi_1}+\size{\Phi'_2}-\size{\beta}$, we can then build
%  \[
%   \Psi\;=\;
%   \vlderivation
%   {
%    \vlde{\Phi''_2}{}
%    {
%     \gamma
%    }
%    {
%     \vlin{\rho}{}
%     {
%      \beta'
%     }
%     {
%      \vlde{\Psi'}{}
%      {
%       \gamma'
%      }
%      {
%       \vlhy
%       {
%        \alpha
%       }
%      }
%     }
%    }
%   }\quad,
%  \]
%  with size $\size{\Psi'}+\size{\Phi''_2}=\size{\Phi_1}+\size{\Phi'_2}+\size{\Phi''_2}-\size{\beta}=\size{\Phi_1}+\size{\Phi_2}-\size{\beta}$;

 \item if 
 \[
  \Phi_1\;=\;
  \vls[\vlder{\Phi_{1,1}}{}{\beta_1}{\alpha_1}\;\;.\;\;\vlder{\Phi_{1,2}}{}{\beta_2}{\alpha_2}]
  \qquad\mbox{or}\qquad
  \Phi_1\;=\;
  \vls(\vlder{\Phi_{1,1}}{}{\beta_1}{\alpha_1}\;\;.\;\;\vlder{\Phi_{1,2}}{}{\beta_2}{\alpha_2})
 \]
 we argue by structural induction on $\Phi_2$:
 \begin{enumerate}
  \item if $\Phi_2$ is a formula (resp., a vertical composition), the result follow by a symmetric argument to case \ref{proof:DerComposition:item:Formula} (resp., \ref{proof:DerComposition:item:Vertical}) above.
  \item if
  \[
    \Phi_2\;=\;
    \vls[\vlder{\Phi_{2,1}}{}{\gamma_1}{\beta_1}\;\;.\;\;\vlder{\Phi_{2,2}}{}{\gamma_2}{\beta_2}]
    \qquad\mbox{or}\qquad
    \Phi_2\;=\;
    \vls(\vlder{\Phi_{2,1}}{}{\gamma_1}{\beta_1}\;\;.\;\;\vlder{\Phi_{2,2}}{}{\gamma_2}{\beta_2})
  \]
  then, by the first inductive hypothesis, we can construct
  \[
   \vlder{\Psi_1}{}{\gamma_1}{\alpha_1}
   \qquad\mbox{and}\qquad
   \vlder{\Psi_2}{}{\gamma_2}{\alpha_2}\quad,
  \]
  with size $\size{\Phi_{1,1}}+\size{\Phi_{2,1}}-\size{\beta_1}$ and $\size{\Phi_{1,2}}+\size{\Phi_{2,2}}-\size{\beta_2}$, respectively, we can then build
  \[
   \Psi\;=\;
   \vls[\vlder{\Psi_1}{}{\gamma_1}{\alpha_1}\;\;.\;\;\vlder{\Psi_2}{}{\gamma_2}{\alpha_2}]
   \qquad\mbox{or}\qquad
   \Psi\;=\;
   \vls(\vlder{\Psi_1}{}{\gamma_1}{\alpha_1}\;\;.\;\;\vlder{\Psi_2}{}{\gamma_2}{\alpha_2})
  \]
  with size $\size{\Psi_1}+\size{\Psi_2}=\size{\Phi_{1,1}}+\size{\Phi_{1,2}}+\size{\Phi_{2,1}}+\size{\Phi_{2,2}}-(\size{\beta_1}+\size{\beta_2})=\size{\Phi_1}+\size{\Phi_2}-\size{\beta}$.
 \end{enumerate}
\end{enumerate}
\end{proof}

\begin{definition}\label{definition:DerComposition}
Given derivations $\vlder{\Phi_1}{}{\beta}{\alpha}$ and $\vlder{\Phi_2}{}{\gamma}{\beta}$, the derivation $\vlder{\Psi}{}{\gamma}{\alpha}$ constructed in the proof of Lemma~\vref{lemma:DerComposition} is denoted:
\[
\vlderivation
{
 \vlde{\Phi_2}{}{\gamma}
 {
  \vlde{\Phi_1}{}{\beta}
  {
   \vlhy{\alpha}
  }
 }
}\quad.
\]
\end{definition}

\section{The Calculus of Structures}\label{section:CalculusOfStructures}

\begin{definition}\label{definition:CoS}
Given a deductive system $\mathcal S$, a set of formulae, $\mathcal F$, and $\alpha$ and $\beta$ from $\mathcal F$; a \emph{calculus of structures derivation $\Psi$ in $\mathcal S$ from $\alpha$ to $\beta$}, denoted $\vlder{\Psi}{\mathcal{S}}{\beta}{\alpha}$, is defined to be
\begin{enumerate}
 \item\label{definition:CoS:item:Formula} a formula: $\Psi\;=\;\alpha\equiv\beta$; or

 \item\label{definition:CoS:item:Vertical} a \emph{vertical composition}:
 \[
 \Psi\;=\;
 \vlderivation
 {
  \vlde{\Phi_2}{}
  {
   \beta
  }
  {
   \vlin{\rho}{}
   {
    \xi\{\alpha'\}
   }
   {
    \vlde{\Phi_1}{}
    {
     \xi\{\beta'\}
    }
    {
     \vlhy
     {
      \alpha
     }
    }
   }
  }
 }
 \quad,
 \]
 where $\vlinf{\rho}{}{\alpha'}{\beta'}$ is an instance of an inference rule from $\mathcal{S}$, and $\vlder{\Phi_1}{\mathcal S}{\xi\{\beta'\}}{\alpha}$ and $\vlder{\Phi_2}{\mathcal S}{\beta}{\xi\{\alpha'\}}$ are calculus of structures derivations.
\end{enumerate}
The size of a calculus of structures derivation $\Psi$, denoted $\size{\Psi}$, is defined to be the sum of the size of the formulae appearing in $\Psi$.
\end{definition}

\begin{theorem}
A calculus of structures derivation $\vlder{\Phi}{}{\beta}{\alpha}$ can be transformed into a functorial calculus derivation $\vlder{\Psi}{}{\beta}{\alpha}$ such that $\size{\Psi}\le\size{\Phi}$.
\end{theorem}

\begin{proof}
We argue by structural induction on $\Phi$. The base case is trivial; $\Phi=\alpha\equiv\beta=\Psi$. For the inductive case, consider the following calculus of structures derivation:
\[
\Phi\;=\;
 \vlinf{\rho}{}
 {
  \vlder{\Phi_2}{}
  {
   \beta
  }
  {
   \xi\{\alpha'\}
  }
 }
 {
  \vlder{\Phi_1}{}
  {
   \xi\{\beta'\}
  }
  {
   \alpha
  }
 }
\quad.
\]
By the inductive hypothesis, there are functorial calculus derivations $\vlder{\Psi_1}{}{\xi\{\beta'\}}{\alpha}$ and $\vlder{\Psi_2}{}{\beta}{\xi\{\alpha'\}}$, such that $\size{\Psi_1}\le\size{\Phi_1}$ and $\size{\Psi_2}\le\size{\Phi_2}$. By Lemma~\vref{lemma:DerInContext}, there is a functorial calculus derivation $\xi\left\{\vlinf{\rho}{}{\alpha'}{\beta'}\right\}$, with size $\size{\xi\vlhole}+\size{\alpha'}+\size{\beta'}$. By Lemma~\vref{lemma:DerComposition}, we can combine the three functorial calculus derivations to create $\vlder{\Psi}{}{\beta}{\alpha}$, with size $\size{\Psi_1}+\size{\Psi_2}+\size{\xi\vlhole}+\size{\beta'}+\size{\alpha'}-\size{\xi\vlhole}-\size{\beta'}-\size{\xi\vlhole}-\size{\alpha'}=\size{\Psi_1}+\size{\Psi_2}-\size{\xi\vlhole}\le\size{\Phi_1}+\size{\Phi_2}=\size{\Phi}$.
\end{proof}

\TODO{Compare with the paper by Stephane and Kai.}
\TODO{Considre if it is worth expanding this:}

\begin{theorem}
A functorial calculus derivation corresponds to an equivalence class of calculus of structures derivations modulo bureaucracy of type A.
\end{theorem}